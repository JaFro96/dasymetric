---
output: github_document
---

```{r chunkoptions, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# dasymetric

<!-- badges: start -->
<!-- badges: end -->

The goal of [dasymetric mapping](https://en.wikipedia.org/wiki/Dasymetric_map) is to display statistical data (like census data) in meaningful spatial zones. 

## Installation

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("JaFro96/dasymetric")
```
## Example

As a case study we try to predict population counts for each district of Münster using land cover data as ancillary information.

```{r districts, echo = FALSE}
require(sf)
load("data/population_counts.rda")
plot(population_counts["pop_counts"],breaks = c(0,5000,10000,15000,20000,25000,30000,35000,40000,45000), main="Population (2018)")
```

That's how the population is distributed using area-weighted interpolation:

```{r aw-interpolation, echo = FALSE, messages = FALSE}
require(areal)
# total population
# sum(population_counts["pop_counts"]$pop_counts) # 310610
# big polygon
source_geom = st_union(population_counts)
source = st_sf(ID = 1, pop_sum = sum(population_counts["pop_counts"]$pop_counts), source_geom)
aw_pop = aw_interpolate(population_counts,NR_STATIST,source = source, sid = ID,weight = "sum", extensive = "pop_sum", output = "sf")
plot(aw_pop["pop_sum"],breaks = c(0,5000,10000,15000,20000,25000,30000,35000,40000,45000),main="Area-weighted Interpolation of Population (2018)")
```

```{r dasymetric-method, echo=FALSE, warning=FALSE, messages=FALSE}
require(dasymetric)
load("data/corine_18.rda")
urban = prep_landuse(corine_18)
dm_pop = dasymetric_map(population_counts, source, urban, extensive = "pop_sum")
plot(dm_pop["pop_sum"],breaks = c(0,5000,10000,15000,20000,25000,30000,35000,40000,45000),main="Dasymetric population map based on land use information (2018)")
```


```{r land_cover, echo = FALSE, include = FALSE}
require(sf)
plot(corine_18[1],main="Land cover of Münster")
plot(st_geometry(population_counts),lwd = 3, add=TRUE)
```

## Data Sources
- CORINE Land Cover 5 ha --> [© GeoBasis-DE / BKG (2021)](https://gdz.bkg.bund.de/index.php/default/catalog/product/view/id/1071/s/corine-land-cover-5-ha-stand-2018-clc5-2018/category/8/?___store=default)

- district boundaries --> [opendata.stadt-muenster.de](https://opendata.stadt-muenster.de/dataset/geokoordinaten-der-stadtteil-grenzen-geometriedaten-der-kleinr%C3%A4umigen-gebietsgliederung)

- population counts --> [opendata.stadt-muenster.de](opendata.stadt-muenster.de)
